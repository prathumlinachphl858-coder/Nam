-- ================= LOAD RAYFIELD =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "NamX Control Hub",
    LoadingTitle = "NamX Control Hub",
    LoadingSubtitle = "by Nam",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false
})

local ESPTab   = Window:CreateTab("ESP", 4483362458)
local PerfTab  = Window:CreateTab("Performance", 4483362458)
local AimTab   = Window:CreateTab("Aimbot", 4483362458)
local MiscTab  = Window:CreateTab("Misc", 4483362458)
local BuildTab = Window:CreateTab("Build", 4483362458)

-- ================= SERVICES ======================
local Players     = game:GetService("Players")
local RunService  = game:GetService("RunService")
local Lighting    = game:GetService("Lighting")
local Camera      = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- =================================================
-- ================== ESP DRAWING ==================
-- =================================================
local ESPEnabled    = false
local BoxEnabled    = true
local LineEnabled   = true
local HealthEnabled = true
local DistEnabled   = true

local ESPObjects = {}

local function newLine(t)
    local l = Drawing.new("Line")
    l.Thickness = t or 1
    l.Visible = false
    return l
end

local function createESP(plr)
    if plr == LocalPlayer then return end

    local box = Drawing.new("Square")
    box.Filled = false
    box.Thickness = 1
    box.Visible = false

    local name = Drawing.new("Text")
    name.Size = 13
    name.Center = true
    name.Outline = true
    name.Visible = false

    local dist = Drawing.new("Text")
    dist.Size = 12
    dist.Center = true
    dist.Outline = true
    dist.Visible = false

    local line = newLine(1)
    local health = newLine(3)

    ESPObjects[plr] = {
        box = box,
        name = name,
        dist = dist,
        line = line,
        health = health
    }
end

local function removeESP(plr)
    if ESPObjects[plr] then
        for _,v in pairs(ESPObjects[plr]) do
            v:Remove()
        end
        ESPObjects[plr] = nil
    end
end

for _,p in ipairs(Players:GetPlayers()) do createESP(p) end
Players.PlayerAdded:Connect(createESP)
Players.PlayerRemoving:Connect(removeESP)

RunService.RenderStepped:Connect(function()
    local myChar = LocalPlayer.Character
    local myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")

    for plr,esp in pairs(ESPObjects) do
        local char = plr.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        local hrp = char and char:FindFirstChild("HumanoidRootPart")

        if ESPEnabled and hum and hrp and hum.Health > 0 then
            local pos,on = Camera:WorldToViewportPoint(hrp.Position)
            if on then
                local size = Vector2.new(2000/pos.Z, 3000/pos.Z)
                local x,y = pos.X-size.X/2, pos.Y-size.Y/2

                local color = (plr.Team == LocalPlayer.Team)
                    and Color3.fromRGB(0,255,0)
                    or Color3.fromRGB(255,0,0)

                -- BOX
                if BoxEnabled then
                    esp.box.Size = size
                    esp.box.Position = Vector2.new(x,y)
                    esp.box.Color = color
                    esp.box.Visible = true
                else esp.box.Visible = false end

                -- NAME
                esp.name.Text = plr.Name
                esp.name.Color = color
                esp.name.Position = Vector2.new(pos.X, y-14)
                esp.name.Visible = true

                -- DISTANCE
                if DistEnabled and myHRP then
                    esp.dist.Text = math.floor((myHRP.Position-hrp.Position).Magnitude).." studs"
                    esp.dist.Color = color
                    esp.dist.Position = Vector2.new(pos.X, y-2)
                    esp.dist.Visible = true
                else esp.dist.Visible = false end

                -- LINE
                if LineEnabled then
                    esp.line.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    esp.line.To = Vector2.new(pos.X,pos.Y)
                    esp.line.Color = color
                    esp.line.Visible = true
                else esp.line.Visible = false end

                -- HEALTH
                if HealthEnabled then
                    local hp = hum.Health / hum.MaxHealth
                    local h = size.Y
                    local bx = x - 6
                    esp.health.From = Vector2.new(bx, y+h)
                    esp.health.To   = Vector2.new(bx, y+h-(h*hp))
                    esp.health.Color = Color3.fromRGB(255-(hp*255), hp*255, 0)
                    esp.health.Visible = true
                else esp.health.Visible = false end
            end
        else
            for _,v in pairs(esp) do v.Visible = false end
        end
    end
end)

-- ================= ESP UI =================
ESPTab:CreateToggle({Name="Enable ESP",CurrentValue=false,Callback=function(v) ESPEnabled=v end})
ESPTab:CreateToggle({Name="Box",CurrentValue=true,Callback=function(v) BoxEnabled=v end})
ESPTab:CreateToggle({Name="Line",CurrentValue=true,Callback=function(v) LineEnabled=v end})
ESPTab:CreateToggle({Name="Health",CurrentValue=true,Callback=function(v) HealthEnabled=v end})
ESPTab:CreateToggle({Name="Distance",CurrentValue=true,Callback=function(v) DistEnabled=v end})

-- =================================================
-- ส่วน Aimbot / Performance / Misc / Build
-- ❗ คงเดิมจากสคริปต์น้ำ (ไม่ถูกแตะ)
-- =================================================
